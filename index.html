<!DOCTYPE html>
<html lang="en">
<!-- Head section includes the top level meta information as well as the page title -->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Savings Planner</title>
  <link rel="stylesheet" href="./index.css">
  <script src="./index.js" defer></script>
</head>
<!-- Body section defines what is rendered for the user -->
<body>
  <div class="container">
    <h1>Savings Planner</h1>
    <p class="subheading">
      Add your financial goals below
    </p>
    
    <form id ="goalPlanner">
      <label for="goal1">First goal ($):</label><br>
      <input type="number" id="g1" name="g1" oninput="updateResult()"><br>
      <label for="goal2">Second goal ($):</label><br>
      <input type="number" id="g2" name="g2" oninput="updateResult()">
      <label for="monthly">Monthly Savings ($/mo):</label><br>
      <input type="number" id="savings" name="savings" oninput="updateResult()">
      <label for="range">Priority (0 is prioritize goal 1)</label>
      <input type="range" min="0" max="100" value="0" class="slider" id="priority" oninput="updateResult()">
      
    </form>

    <p>Months to achieve goal 1: <output id = "result1" name="result1"></output></p>
    <p>Months to achieve goal 2: <output id = "result2" name="result2"></output></p>

    <script>
      const form = document.getElementById("goalPlanner");
      const g1 = form.elements["g1"];
      const g2 = form.elements["g2"];
      const monthly = form.elements["savings"];
      const priority = form.elements["priority"];
      
      const result = form.elements["result1"];

      function updateResult() {
        const g1Value = parseInt(g1.value);
        const g2Value = parseInt(g2.value);
        const monthlyValue = parseInt(monthly.value);
        const priorityValue = parseInt(priority.value);
        //result.value = g1Value / (monthlyValue * (priorityValue / 100));
        const d = new Date();
        const month = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        
        var tempMonth = d.getMonth();
        var xrange = month[tempMonth];

        var r1 = 0;
        var r2 = 0;
        
        var goal1Met = false;
        var goal2Met = false;
        var y1 = [0];
        var y2 = [0];

        while (!(goal1Met && goal2Met)){
          // calculate proportional monthly savings
          var p1 = monthlyValue * (1 - (priorityValue / 100));
          var p2 = monthlyValue * (priorityValue / 100);
          
          // check if goal will be met this "month"
          if (g1Value - y1[y1.length - 1] < p1){
            y1.push(g1Value);
            p2 += p1 - (g1Value - y1[y1.length - 1]);
            goal1Met = true;
          } else if (g2Value - y2[y2.length - 1] < p2){
            y2.push(g2Value);
            p1 += p2 - (g2Value - y2[y2.length - 1]);
            goal2Met = true;
          }

          // if neither goal met, add proportional monthly savings
          if (!(goal1Met || goal2Met)){
            y1.push(y1[y1.length - 1] + p1);
            y2.push(y2[y2.length - 1] + p2);
          } else if (goal1Met){
            y2.push(y2[y2.length - 1] + p2);
          } else if (goal2Met){
            y1.push(y1[y1.length - 1] + p1);
          }

          // increment xrange
          tempMonth += 1;
          xrange.push(tempMonth % 12);
        }

        document.getElementById("result1").value = Math.round(r1);
        document.getElementById("result2").value = Math.round(r2);
      }
    </script>
    
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8">
      // generate bar chart
      var trace1 = {
        x: xrange,
        y: y1,
        name: 'Goal 1',
        type: 'bar'
      };

      var trace2 = {
        x: xrange,
        y: y2,
        name: 'Goal 2',
        type: 'bar'
      };

      var data = [trace1, trace2];

      var layout = {barmode: 'group'};

      Plotly.newPlot('myDiv', data, layout);

      //form.addEventListener("input", updateResult);

      //updateResult();

      //const firstForm = document.forms[0];
      //console.log(firstForm);
    </script>
    
    <!--
    <div class="square" id="circleID"></div>
    <div class="action">
      <button onclick="paint('red')">Red</button>
      <button onclick="paint('green')">Green</button>
      <button onclick="paint('yellow')">Yellow</button>
    </div>
    -->
  </div>
</body>
</html>
